#!/bin/sh -l

#PBS -l nodes=1:ppn=24
#PBS -l walltime=0:30:00
#PBS -n
#PBS -p 1023
#PBS -j oe

set -eou pipefail

main() {
    if [ -z ${P+x} ] || [ -z ${EXE+x} ] || [ -z ${N+x} ]; then
        echo "usage: qsub run.pbs -N <name> -vP=<p>,EXE=<executable>,N=<n>"
        exit -1
    fi

    mpirun -n "$P" "$EXE" -n "$N"
}

module load cs5220
cd $PBS_O_WORKDIR
main
